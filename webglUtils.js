/*
 * Copyright 2021 GFXFundamentals.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of GFXFundamentals. nor the names of his
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

!function(t,e){"function"==typeof define&&define.amd?define([],function(){return e.call(t)}):t.webglUtils=e.call(t)}(this,function(){"use strict";var t,e;let n=this;function r(t){n.console&&(n.console.error?n.console.error(t):n.console.log&&n.console.log(t))}function i(t,e,n,i){let o=t.createShader(n);t.shaderSource(o,e),t.compileShader(o);let u=t.getShaderParameter(o,t.COMPILE_STATUS);if(!u){let f=t.getShaderInfoLog(o);return(i||r)("*** Error compiling shader '"+o+"':"+f+`
`+e.split("\n").map((t,e)=>`${e+1}: ${t}`).join("\n")),t.deleteShader(o),null}return o}function o(t,e,n,i,o){let u=t.createProgram();e.forEach(function(e){t.attachShader(u,e)}),n&&n.forEach(function(e,n){t.bindAttribLocation(u,i?i[n]:n,e)}),t.linkProgram(u);let f=t.getProgramParameter(u,t.LINK_STATUS);if(!f){let a=t.getProgramInfoLog(u);return(o||r)("Error in program linking:"+a),t.deleteProgram(u),null}return u}function u(t,e,n,r){let o="",u,f=document.getElementById(e);if(!f)throw"*** Error: unknown script element"+e;if(o=f.text,!n){if("x-shader/x-vertex"===f.type)u=t.VERTEX_SHADER;else if("x-shader/x-fragment"===f.type)u=t.FRAGMENT_SHADER;else if(u!==t.VERTEX_SHADER&&u!==t.FRAGMENT_SHADER)throw"*** Error: unknown shader type"}return i(t,o,n||u,r)}(t=t||n).top;let f=["VERTEX_SHADER","FRAGMENT_SHADER",];function a(t,e){return e===t.SAMPLER_2D?t.TEXTURE_2D:e===t.SAMPLER_CUBE?t.TEXTURE_CUBE_MAP:void 0}function l(t,e){let n=0;function r(e,r){var i,o,u,f;let l=t.getUniformLocation(e,r.name),c=r.type,s=r.size>1&&"[0]"===r.name.substr(-3);if(c===t.FLOAT&&s)return function(e){t.uniform1fv(l,e)};if(c===t.FLOAT)return function(e){t.uniform1f(l,e)};if(c===t.FLOAT_VEC2)return function(e){t.uniform2fv(l,e)};if(c===t.FLOAT_VEC3)return function(e){t.uniform3fv(l,e)};if(c===t.FLOAT_VEC4)return function(e){t.uniform4fv(l,e)};if(c===t.INT&&s)return function(e){t.uniform1iv(l,e)};if(c===t.INT)return function(e){t.uniform1i(l,e)};if(c===t.INT_VEC2)return function(e){t.uniform2iv(l,e)};if(c===t.INT_VEC3)return function(e){t.uniform3iv(l,e)};if(c===t.INT_VEC4)return function(e){t.uniform4iv(l,e)};if(c===t.BOOL)return function(e){t.uniform1iv(l,e)};if(c===t.BOOL_VEC2)return function(e){t.uniform2iv(l,e)};if(c===t.BOOL_VEC3)return function(e){t.uniform3iv(l,e)};if(c===t.BOOL_VEC4)return function(e){t.uniform4iv(l,e)};if(c===t.FLOAT_MAT2)return function(e){t.uniformMatrix2fv(l,!1,e)};if(c===t.FLOAT_MAT3)return function(e){t.uniformMatrix3fv(l,!1,e)};if(c===t.FLOAT_MAT4)return function(e){t.uniformMatrix4fv(l,!1,e)};if((c===t.SAMPLER_2D||c===t.SAMPLER_CUBE)&&s){let m=[];for(let E=0;E<info.size;++E)m.push(n++);return i=a(t,c),o=m,function(e){t.uniform1iv(l,o),e.forEach(function(e,n){t.activeTexture(t.TEXTURE0+o[n]),t.bindTexture(i,e)})}}if(c===t.SAMPLER_2D||c===t.SAMPLER_CUBE)return u=a(t,c),f=n++,function(e){t.uniform1i(l,f),t.activeTexture(t.TEXTURE0+f),t.bindTexture(u,e)};throw"unknown type: 0x"+c.toString(16)}let i={},o=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let u=0;u<o;++u){let f=t.getActiveUniform(e,u);if(!f)break;let l=f.name;"[0]"===l.substr(-3)&&(l=l.substr(0,l.length-3));let c=r(e,f);i[l]=c}return i}function c(t,...e){for(let n of(t=t.uniformSetters||t,e))Object.keys(n).forEach(function(e){let r=t[e];r&&r(n[e])})}function s(t,e){let n={};function r(e){return function(n){if(n.value)switch(t.disableVertexAttribArray(e),n.value.length){case 4:t.vertexAttrib4fv(e,n.value);break;case 3:t.vertexAttrib3fv(e,n.value);break;case 2:t.vertexAttrib2fv(e,n.value);break;case 1:t.vertexAttrib1fv(e,n.value);break;default:throw Error("the length of a float constant value must be between 1 and 4!")}else t.bindBuffer(t.ARRAY_BUFFER,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,n.numComponents||n.size,n.type||t.FLOAT,n.normalize||!1,n.stride||0,n.offset||0)}}let i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let o=0;o<i;++o){let u=t.getActiveAttrib(e,o);if(!u)break;let f=t.getAttribLocation(e,u.name);n[u.name]=r(f)}return n}function m(t,e){t=t.attribSetters||t,Object.keys(e).forEach(function(n){let r=t[n];r&&r(e[n])})}function E(t,e,n,r){let i=t.createVertexArray();return t.bindVertexArray(i),m(e,n),r&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bindVertexArray(null),i}function A(t,e,n){m(e,n.attribs),n.indices&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.indices)}let d=["","MOZ_","OP_","WEBKIT_",];function g(t,e,n){var r,i;let o=n||Float32Array,u;return r=new o(t*e),i=t,u=0,r.push=function(){for(let t=0;t<arguments.length;++t){let e=arguments[t];if(e instanceof Array||e.buffer&&e.buffer instanceof ArrayBuffer)for(let n=0;n<e.length;++n)r[u++]=e[n];else r[u++]=e}},r.reset=function(t){u=t||0},r.numComponents=i,Object.defineProperty(r,"numElements",{get:function(){return this.length/this.numComponents|0}}),r}function h(t,e,n,r){n=n||t.ARRAY_BUFFER;let i=t.createBuffer();return t.bindBuffer(n,i),t.bufferData(n,e,r||t.STATIC_DRAW),i}function T(t){return"indices"!==t}function p(t){return t.buffer&&t.buffer instanceof ArrayBuffer}function b(t,e){let n;if(e%(n=t.indexOf("coord")>=0?2:t.indexOf("color")>=0?4:3)>0)throw"can not guess numComponents. You should specify it.";return n}function v(t,e){if(p(t))return t;if(t.data&&p(t.data))return t.data;Array.isArray(t)&&(t={data:t}),t.numComponents||(t.numComponents=b(e,t.length));let n=t.type;n||"indices"!==e||(n=Uint16Array);let r=g(t.numComponents,t.data.length/t.numComponents|0,n);return r.push(t.data),r}function S(t,e,n){let r=n||function t(e){let n={};return Object.keys(e).filter(T).forEach(function(t){n["a_"+t]=t}),n}(e),i={};return Object.keys(r).forEach(function(n){let o=r[n],u=e[o];if(u.value)i[n]={value:u.value};else{var f;let a=v(u,o);i[n]={buffer:h(t,a),numComponents:u.numComponents||a.numComponents||b(o),type:function t(e,n){if(n instanceof Int8Array)return e.BYTE;if(n instanceof Uint8Array)return e.UNSIGNED_BYTE;if(n instanceof Int16Array)return e.SHORT;if(n instanceof Uint16Array)return e.UNSIGNED_SHORT;if(n instanceof Int32Array)return e.INT;if(n instanceof Uint32Array)return e.UNSIGNED_INT;if(n instanceof Float32Array)return e.FLOAT;throw"unsupported typed array type"}(t,a),normalize:!!((f=a)instanceof Int8Array||f instanceof Uint8Array)}}}),i}function R(t){return t.length?t:t.data}let y=/coord|texture/i,$=/color|colour/i;function b(t,e){let n;if(e%(n=y.test(t)?2:$.test(t)?4:3)>0)throw Error(`Can not guess numComponents for attribute '${t}'. Tried ${n} but ${e} values is not evenly divisible by ${n}. You should specify it.`);return n}let x=["position","positions","a_position"];function C(t,e,n,r,i){let o=e.indices;n=void 0===n?t.TRIANGLES:n;let u=void 0===r?e.numElements:r;i=void 0===i?0:i,o?t.drawElements(n,u,t.UNSIGNED_SHORT,i):t.drawArrays(n,i,u)}let F=!!document.documentMode,L=!F&&!!window.StyleMedia;return L&&(HTMLCanvasElement.prototype.getContext=(e=HTMLCanvasElement.prototype.getContext,function(){let t=arguments,n=t[0];return"webgl"===n&&(t=[].slice.call(arguments),t[0]="experimental-webgl"),e.apply(this,t)})),{createAugmentedTypedArray:g,createAttribsFromArrays:S,createBuffersFromArrays:function t(e,n){let r={};return Object.keys(n).forEach(function(t){let i="indices"===t?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER,o=v(n[t],name);r[t]=h(e,o,i)}),n.indices?r.numElements=n.indices.length:n.position&&(r.numElements=n.position.length/3),r},createBufferInfoFromArrays:function t(e,n,r){let i={attribs:S(e,n,r)},o=n.indices;return o?(o=v(o,"indices"),i.indices=h(e,o,e.ELEMENT_ARRAY_BUFFER),i.numElements=o.length):i.numElements=function t(e){var n,r;let i;for(let o of x)if(o in e){i=o;break}i=i||Object.keys(e)[0];let u=e[i],f=R(u).length,a=(n=u,r=i,n.numComponents||n.size||b(r,R(n).length));if(f%a>0)throw Error(`numComponents ${a} not correct for length ${f}`);return f/a}(n),i},createAttributeSetters:s,createProgram:o,createProgramFromScripts:function t(e,n,r,i,a){let l=[];for(let c=0;c<n.length;++c)l.push(u(e,n[c],e[f[c]],a));return o(e,l,r,i,a)},createProgramFromSources:function t(e,n,r,u,a){let l=[];for(let c=0;c<n.length;++c)l.push(i(e,n[c],e[f[c]],a));return o(e,l,r,u,a)},createProgramInfo:function t(e,n,r,i,o){n=n.map(function(t){let e=document.getElementById(t);return e?e.text:t});let u=webglUtils.createProgramFromSources(e,n,r,i,o);if(!u)return null;let f=l(e,u),a=s(e,u);return{program:u,uniformSetters:f,attribSetters:a}},createUniformSetters:l,createVAOAndSetAttributes:E,createVAOFromBufferInfo:function t(e,n,r){return E(e,n.attribSetters||n,r.attribs,r.indices)},drawBufferInfo:C,drawObjectList:function t(e,n){let r=null,i=null;n.forEach(function(t){let n=t.programInfo,o=t.bufferInfo,u=!1;n!==r&&(r=n,e.useProgram(n.program),u=!0),(u||o!==i)&&(i=o,A(e,n.attribSetters,o)),c(n.uniformSetters,t.uniforms),C(e,o)})},glEnumToString:function t(e,n){let r=[];for(let i in e)e[i]===n&&r.push(i);return r.length?r.join(" | "):`0x${n.toString(16)}`},getExtensionWithKnownPrefixes:function t(e,n){for(let r=0;r<d.length;++r){let i=d[r]+n,o=e.getExtension(i);if(o)return o}},resizeCanvasToDisplaySize:function t(e,n){n=n||1;let r=e.clientWidth*n|0,i=e.clientHeight*n|0;return(e.width!==r||e.height!==i)&&(e.width=r,e.height=i,!0)},setAttributes:m,setBuffersAndAttributes:A,setUniforms:c}});